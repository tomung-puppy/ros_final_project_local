<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 대시보드</title>
    <link rel="stylesheet" href="/static/admin_style.css">
</head>
<body>
    <div class="container">
        <h1>오피스 로봇 관제 시스템</h1>
        
        <h2>실시간 로봇 상태</h2>
        <div id="robot-status-container">
            <!-- 로봇 상태 정보가 여기에 동적으로 추가됩니다. -->
        </div>

        <div id="map-container">
            <h2>실시간 맵</h2>
            <div class="map-placeholder">
                <p>지도 시각화 영역</p>
            </div>
        </div>
    </div>

    <script>
        function fetchRobotStatus() {
            // API 엔드포인트를 통합된 FastAPI 경로로 수정
            fetch('/api/v1/admin/robots/status')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('robot-status-container');
                    // 기존 내용 초기화
                    container.innerHTML = '';
                    
                    if (data.length === 0) {
                        container.innerHTML = '<p>사용 가능한 로봇이 없습니다.</p>';
                        return;
                    }

                    data.forEach(robot => {
                        const robotDiv = document.createElement('div');
                        robotDiv.className = 'robot-status-card';
                        // Pydantic 모델의 필드명에 맞게 수정 (e.g., pose_x, pose_y)
                        robotDiv.innerHTML = `
                            <h3>${robot.name} (ID: ${robot.id})</h3>
                            <p>상태: <strong>${robot.status}</strong></p>
                            <p>위치: (${robot.pose_x.toFixed(2)}, ${robot.pose_y.toFixed(2)})</p>
                            <p>배터리: ${robot.battery_level}%</p>
                        `;
                        container.appendChild(robotDiv);
                    });
                })
                .catch(error => console.error('Error fetching robot status:', error));
        }

        // 5초마다 상태를 업데이트합니다.
        setInterval(fetchRobotStatus, 5000);
        // 페이지 로드 시 즉시 실행
        document.addEventListener('DOMContentLoaded', fetchRobotStatus);
    </script>
</body>
</html>
